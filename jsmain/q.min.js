(function(l){"function"===typeof bootstrap?bootstrap("promise",l):"object"===typeof exports?module.exports=l():"function"===typeof define&&define.amd?define(l):"undefined"!==typeof ses?ses.ok()&&(ses.makeQ=l):Q=l()})(function(){function l(a){var b=Function.call;return function(){return b.apply(a,arguments)}}function T(a,b){D&&(b.stack&&"object"===typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(U))&&(a.stack=V(a.stack)+"\n"+U+"\n"+V(b.stack))}function V(a){a=a.split("\n");for(var b=[],d=0;d<a.length;++d){var e=
a[d],c;if(c=W(e)){var h=c[1];c=c[0]===X&&h>=ia&&h<=ja}else c=!1;!c&&(!(-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:"))&&e)&&b.push(e)}return b.join("\n")}function W(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b||(b=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a)))return[b[1],Number(b[2])];if(a=/.*@(.+):(\d+)$/.exec(a))return[a[1],Number(a[2])]}function Y(){if(D)try{throw Error();}catch(a){var b=a.stack.split("\n"),b=0<b[0].indexOf("@")?b[1]:b[2];if(b=W(b))return X=b[0],b[1]}}function c(a){return s(a)}
function k(){function a(a){e=a;w(b,function(b,d){m(function(){a.promiseDispatch.apply(a,d)})},void 0);d=b=void 0}var b=[],d=[],e,f=H(k.prototype),h=H(n.prototype);h.promiseDispatch=function(a,c,h){var f=j(arguments);b?(b.push(f),"when"===c&&h[1]&&d.push(h[1])):m(function(){e.promiseDispatch.apply(e,f)})};h.valueOf=function(){if(b)return h;var a=q(e);x(a)&&(e=a);return a};if(0<c.longStackJumpLimit&&D)try{throw Error();}catch(g){h.stack=g.stack.substring(g.stack.indexOf("\n")+1)}f.promise=h;f.resolve=
function(b){e||a(s(b))};f.fulfill=function(b){e||a(I(b))};f.reject=function(b){e||a(p(b))};f.notify=function(a){e||w(d,function(b,d){m(function(){d(a)})},void 0)};return f}function n(a,b,d,c,f){void 0===b&&(b=function(a){return p(Error("Promise does not support operation: "+a))});var h=H(n.prototype);h.promiseDispatch=function(d,c,e){var f;try{f=a[c]?a[c].apply(h,e):b.call(h,c,e)}catch(g){f=p(g)}d&&d(f)};d&&(h.valueOf=d);f&&(h.exception=c);return h}function q(a){return x(a)?a.valueOf():a}function x(a){return a===
Object(a)&&"function"===typeof a.promiseDispatch}function J(a){return a===Object(a)&&"function"===typeof a.then}function K(a){return!J(q(a))}function Z(a){a=q(a);return x(a)&&"exception"in a}function $(){for(var a=0;a<r.length;a++){var b=r[a];b&&"undefined"!==typeof b.stack?console.warn("Unhandled rejection reason:",b.stack):console.warn("Unhandled rejection reason (no stack):",b)}}function L(){r.length=0;E.length=0;M=!1;if(!y&&(y=!0,"undefined"!==typeof process&&process.on))process.on("exit",$)}
function p(a){var b=n({when:function(b){if(b&&y){var c=ka(E,this);-1!==c&&(E.splice(c,1),r.splice(c,1))}return b?b(a):this}},function(){return this},function(){return this},a,!0);y&&(E.push(b),r.push(a),!M&&("undefined"!==typeof window&&!window.Touch&&window.console)&&console.warn("[Q] Unhandled rejection reasons (should be empty):",r),M=!0);return b}function I(a){return n({when:function(){return a},get:function(b){return a[b]},set:function(b,d){a[b]=d},"delete":function(b){delete a[b]},post:function(b,
d){return null===b||void 0===b?a.apply(void 0,d):a[b].apply(a,d)},apply:function(b,d){return a.apply(b,d)},keys:function(){return la(a)}},void 0,function(){return a})}function s(a){if(x(a))return a;a=q(a);if(J(a)){var b=a,d=k();m(function(){try{b.then(d.resolve,d.reject,d.notify)}catch(a){d.reject(a)}});return d.promise}return I(a)}function g(a,b,d,e){function f(a){try{return"function"===typeof b?b(a):a}catch(d){return p(d)}}function h(a){if("function"===typeof d){T(a,l);try{return d(a)}catch(b){return p(b)}}return p(a)}
var g=k(),j=!1,l=s(a);m(function(){l.promiseDispatch(function(a){j||(j=!0,g.resolve(f(a)))},"when",[function(a){j||(j=!0,g.resolve(h(a)))}])});l.promiseDispatch(void 0,"when",[void 0,function(a){var b,d=!1;try{b="function"===typeof e?e(a):a}catch(h){if(d=!0,c.onerror)c.onerror(h);else throw h;}d||g.notify(b)}]);return g.promise}function aa(a,b,d){return g(a,function(a){return F(a).then(function(a){return b.apply(void 0,a)},d)},d)}function z(a,b,d){var c=k();m(function(){s(a).promiseDispatch(c.resolve,
b,d)});return c.promise}function t(a){return function(b){var d=j(arguments,1);return z(b,a,d)}}function ba(a,b){var d=j(arguments,2);return N(a,b,d)}function u(a,b){return z(a,"apply",[void 0,b])}function O(a){var b=j(arguments,1);return u(a,b)}function F(a){return g(a,function(a){var d=0,c=k();w(a,function(f,h,j){K(h)?a[j]=q(h):(++d,g(h,function(h){a[j]=h;0===--d&&c.resolve(a)},c.reject))},void 0);0===d&&c.resolve(a);return c.promise})}function ca(a,b){return g(a,void 0,b)}var D=!1;try{throw Error();
}catch(ma){D=!!ma.stack}var ia=Y(),X,da=function(){},m;if("function"===typeof setImmediate)m="undefined"!==typeof window?setImmediate.bind(window):setImmediate;else if("undefined"!==typeof process&&process.nextTick)m=process.nextTick;else{var ea=function(){--v;if(++P>=A){P=0;A*=4;for(var a=B&&Math.min(B-1,A);v<a;)++v,G()}for(;B;)--B,C=C.next,a=C.task,C.task=void 0,a();P=0},C={task:void 0,next:null},fa=C,A=2,v=0,B=0,P=0,G=void 0;m=function(a){fa=fa.next={task:a,next:null};v<++B&&v<A&&(++v,G())};if("undefined"!==
typeof MessageChannel){var ga=new MessageChannel;ga.port1.onmessage=ea;G=function(){ga.port2.postMessage(0)}}else G=function(){setTimeout(ea,0)}}var j=l(Array.prototype.slice),w=l(Array.prototype.reduce||function(a,b){var d=0,c=this.length;if(1===arguments.length){do{if(d in this){b=this[d++];break}if(++d>=c)throw new TypeError;}while(1)}for(;d<c;d++)d in this&&(b=a(b,this[d],d));return b}),ka=l(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),
ha=l(Array.prototype.map||function(a,b){var d=this,c=[];w(d,function(f,h,g){c.push(a.call(b,h,g,d))},void 0);return c}),H=Object.create||function(a){function b(){}b.prototype=a;return new b},na=l(Object.prototype.hasOwnProperty),la=Object.keys||function(a){var b=[],d;for(d in a)na(a,d)&&b.push(d);return b},oa=l(Object.prototype.toString),R;R="undefined"!==typeof ReturnValue?ReturnValue:function(a){this.value=a};var S;try{new Function("(function* (){ yield 1; })"),S=!0}catch(pa){S=!1}c.longStackJumpLimit=
1;var U="From previous event:";c.nextTick=m;c.defer=k;k.prototype.makeNodeResolver=function(){var a=this;return function(b,d){b?a.reject(b):2<arguments.length?a.resolve(j(arguments,1)):a.resolve(d)}};c.promise=function(a){if("function"!==typeof a)throw new TypeError("resolver must be a function.");var b=k();O(a,b.resolve,b.reject,b.notify).fail(b.reject);return b.promise};c.makePromise=n;n.prototype.then=function(a,b,d){return g(this,a,b,d)};n.prototype.thenResolve=function(a){return g(this,function(){return a})};
n.prototype.thenReject=function(a){return g(this,function(){throw a;})};w("isFulfilled isRejected isPending dispatch when spread get set del delete post send invoke keys fapply fcall fbind all allResolved timeout delay catch finally fail fin progress done nfcall nfapply nfbind denodeify nbind npost nsend ninvoke nodeify".split(" "),function(a,b){n.prototype[b]=function(){return c[b].apply(c,[this].concat(j(arguments)))}},void 0);n.prototype.toSource=function(){return this.toString()};n.prototype.toString=
function(){return"[object Promise]"};c.nearer=q;c.isPromise=x;c.isPromiseAlike=J;c.isPending=function(a){return!K(a)&&!Z(a)};c.isFulfilled=K;c.isRejected=Z;var r=[],E=[],M=!1,y=!0;c.resetUnhandledRejections=L;c.getUnhandledReasons=function(){return r.slice()};c.stopUnhandledRejectionTracking=function(){L();"undefined"!==typeof process&&process.on&&process.removeListener("exit",$);y=!1};L();c.reject=p;c.fulfill=I;c.resolve=s;c.master=function(a){return n({isDef:function(){}},function(b,d){return z(a,
b,d)},function(){return q(a)})};c.when=g;c.spread=aa;c.async=function(a){return function(){function b(a,b){var j;if(S){try{j=d[a](b)}catch(l){return p(l)}return j.done?j.value:g(j.value,c,f)}try{j=d[a](b)}catch(k){return"[object StopIteration]"===oa(k)||k instanceof R?k.value:p(k)}return g(j,c,f)}var d=a.apply(this,arguments),c=b.bind(b,"send"),f=b.bind(b,"throw");return c()}};c["return"]=function(a){throw new R(a);};c.promised=function(a){return function(){return aa([this,F(arguments)],function(b,
d){return a.apply(b,d)})}};c.dispatch=z;c.dispatcher=t;c.get=t("get");c.set=t("set");c["delete"]=c.del=t("delete");var N=c.post=t("post");c.send=ba;c.invoke=ba;c.fapply=u;c["try"]=O;c.fcall=O;c.fbind=function(a){var b=j(arguments,1);return function(){var d=b.concat(j(arguments));return z(a,"apply",[this,d])}};c.keys=t("keys");c.all=F;c.allResolved=function(a){return g(a,function(a){a=ha(a,s);return g(F(ha(a,function(a){return g(a,da,da)})),function(){return a})})};c["catch"]=c.fail=ca;c.progress=
function(a,b){return g(a,void 0,void 0,b)};c["finally"]=c.fin=function(a,b){return g(a,function(a){return g(b(),function(){return a})},function(a){return g(b(),function(){return p(a)})})};c.done=function(a,b,d,e){var f=function(b){m(function(){T(b,a);if(c.onerror)c.onerror(b);else throw b;})};b=b||d||e?g(a,b,d,e):a;"object"===typeof process&&(process&&process.domain)&&(f=process.domain.bind(f));ca(b,f)};c.timeout=function(a,b,d){var c=k(),f=setTimeout(function(){c.reject(Error(d||"Timed out after "+
b+" ms"))},b);g(a,function(a){clearTimeout(f);c.resolve(a)},function(a){clearTimeout(f);c.reject(a)},c.notify);return c.promise};c.delay=function(a,b){void 0===b&&(b=a,a=void 0);var d=k();g(a,void 0,void 0,d.notify);setTimeout(function(){d.resolve(a)},b);return d.promise};c.nfapply=function(a,b){var d=j(b),c=k();d.push(c.makeNodeResolver());u(a,d).fail(c.reject);return c.promise};c.nfcall=function(a){var b=j(arguments,1),c=k();b.push(c.makeNodeResolver());u(a,b).fail(c.reject);return c.promise};c.nfbind=
function(a){var b=j(arguments,1);return function(){var c=b.concat(j(arguments)),e=k();c.push(e.makeNodeResolver());u(a,c).fail(e.reject);return e.promise}};c.denodeify=c.nfbind;c.nbind=function(a,b){var c=j(arguments,2);return function(){var e=c.concat(j(arguments)),f=k();e.push(f.makeNodeResolver());u(function(){return a.apply(b,arguments)},e).fail(f.reject);return f.promise}};c.npost=function(a,b,c){c=j(c||[]);var e=k();c.push(e.makeNodeResolver());N(a,b,c).fail(e.reject);return e.promise};c.nsend=
function(a,b){var c=j(arguments,2),e=k();c.push(e.makeNodeResolver());N(a,b,c).fail(e.reject);return e.promise};c.ninvoke=c.nsend;c.nodeify=function(a,b){if(b)a.then(function(a){m(function(){b(null,a)})},function(a){m(function(){b(a)})});else return a};var ja=Y();return c});
