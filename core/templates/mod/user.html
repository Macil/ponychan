{% if new %}
	{% set action = '?/users/new' %}
{% else %}
	{% set action = '?/users/' ~ user.id %}
{% endif %}

<form action="{{ action|e }}" method="post">
	<table>
		<tr>
			<th>{% trans 'Username' %}</th>
			<td>
				{% if new or mod|hasPermission('editusers') %}
					<input size="20" maxlength="30" type="text" name="username" value="{{ user.username|e }}" autocomplete="off">
				{% else %}
					{{ user.username|e }}
				{% endif %}
			</td>
		</tr>
		<tr>
			<th>{% trans 'Password' %}{% if not new %} <small style="font-weight:normal">({% trans 'new; optional' %})</small>{% endif %}</th>
			<td>
				{% if new or (mod|hasPermission('editusers') or (mod|hasPermission('change_password') and user.id == mod.id)) %}
					<input size="20" maxlength="30" type="password" name="password" value="" autocomplete="off">
				{% else %}
					-
				{% endif %}
			</td>
		</tr>
		{% if new %}
			<tr>
				<th>{% trans 'Class' %}</th>
				<td>
					<ul style="padding:5px 8px;list-style:none">
						<li>
							<input type="radio" name="type" id="founder" value="{{ constant('FOUNDER') }}">
							 <label for="founder">{% trans 'Founder' %}</label>
						</li>
						<li>
							<input type="radio" name="type" id="developer" value="{{ constant('DEVELOPER') }}">
							 <label for="developer">{% trans 'Developer' %}</label>
						</li>
						<li>
							<input type="radio" name="type" id="janitor" value="{{ constant('JANITOR') }}">
							 <label for="janitor">{% trans 'Janitor' %}</label>
						</li>
						<li>
							<input type="radio" name="type" id="mod" value="{{ constant('MOD') }}" checked>
							 <label for="mod">{% trans 'Mod' %}</label>
						</li>
						<li>
							<input type="radio" name="type" id="admin" value="{{ constant('Admin') }}">
							 <label for="admin">{% trans 'Admin' %}</label>
						</li>
					</ul>
				</td>
			</tr>
		{% endif %}
		<tr>
			<th>{% trans 'Boards' %}</th>
			<td>
				<ul style="padding:0 5px;list-style:none">
					<li>
						<input type="checkbox" id="allboards" name="allboards"
						{% if '*' in user.boards %} checked{% endif %}
						{% if not mod|hasPermission('editusers') %}
						 disabled
						{% endif %}
						>
						 <label for="allboards">"*" - {% trans 'All boards' %}</label>
					</li>
					{% for board in boards %}
						<li>
							<input type="checkbox" id="board_{{ board.uri }}" name="board_{{ board.uri }}"
								{% if board.uri in user.boards %} checked{% endif %}
								{% if not mod|hasPermission('editusers') %}
								 disabled
								{% endif %}
								>
							 <label for="board_{{ board.uri }}">
								{{ config.board_abbreviation|sprintf(board.uri)|e }}
								 -
								 {{ board.title|e }}
							</label>
						</li>
					{% endfor %}
				</ul>
			</td>
		</tr>
	</table>

	<ul style="padding:0;text-align:center;list-style:none">
		{% if new %}
			<li><input type="submit" value="{% trans 'Create user' %}"></li>
		{% else %}
			<li><input type="submit" value="{% trans 'Save changes' %}"></li>
			{% if mod|hasPermission('deleteusers') %}
				<li><input name="delete" onclick="return confirm('Are you sure you want to permanently delete this user?');" type="submit" value="{% trans 'Delete user' %}"></li>
			{% endif %}
		{% endif %}
	</ul>
</form>

{% if logs|count > 0  %}
	<table class="modlog" style="width:600px">
		<tr>
			<th>{% trans 'IP address' %}</th>
			<th>{% trans 'Time' %}</th>
			<th>{% trans 'Board' %}</th>
			<th>{% trans 'Action' %}</th>
		</tr>
		{% for log in logs %}
			<tr>
				<td class="minimal">
					<a href="?/IP/{{ log.ip|ipToUserRange|url_encode|e }}">{{ log.ip|e }}</a>
				</td>
				<td class="minimal">
					<span title="{{ log.time|date(config.post_date)|e }}">{{ log.time|ago|e }}</span>
				</td>
				<td class="minimal">
					{% if log.board %}
						<a href="?/{{ config.board_path|sprintf(log.board)|e }}">{{ config.board_abbreviation|sprintf(log.board)|e }}</a>
					{% else %}
						-
					{% endif %}
				</td>
				<td>
					{{ log.text|r }}
				</td>
			</tr>
		{% endfor %}
	</table>
	<p style="text-align:center" class="unimportant">
		<a href="?/log:{{ user.username|url_encode|e }}">{% trans 'View more logs for this user.' %}</a>
	</p>
{% endif %}
