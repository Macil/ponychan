(function(l){"function"===typeof bootstrap?bootstrap("promise",l):"object"===typeof exports?module.exports=l():"function"===typeof define?define(l):"undefined"!==typeof ses?ses.ok()&&(ses.makeQ=l):Q=l()})(function(){function l(a){var b=Function.call;return function(){return b.apply(a,arguments)}}function I(a,b){b.stack&&("object"===typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(J))&&(a.stack=K(a.stack)+"\n"+J+"\n"+K(b.stack))}function K(a){a=a.split("\n");for(var b=[],d=0;d<a.length;++d){var e=
a[d],c;if(c=/at .+ \((.*):(\d+):\d+\)/.exec(e)){var k=c[2];c=c[1]===L&&k>=X&&k<=Y}else c=!1;!c&&!(-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:"))&&b.push(e)}return b.join("\n")}function M(){if(Error.captureStackTrace){var a,b,d=Error.prepareStackTrace;Error.prepareStackTrace=function(d,c){a=c[1].getFileName();b=c[1].getLineNumber()};Error().stack;Error.prepareStackTrace=d;L=a;return b}}function c(a){return q(a)}function j(){function a(a){b&&(e=q(a),t(b,function(a,b){m(function(){e.promiseDispatch.apply(e,
b)})},void 0),d=b=void 0)}var b=[],d=[],e,f=z(j.prototype),k=z(n.prototype);k.promiseDispatch=function(a,c,k){var f=h(arguments);b?(b.push(f),"when"===c&&k[1]&&d.push(k[1])):m(function(){e.promiseDispatch.apply(e,f)})};k.valueOf=function(){return b?k:e=r(e)};Error.captureStackTrace&&0<c.longStackJumpLimit&&(Error.captureStackTrace(k,j),k.stack=k.stack.substring(k.stack.indexOf("\n")+1));f.promise=k;f.resolve=a;f.fulfill=function(b){a(A(b))};f.reject=function(b){a(p(b))};f.notify=function(a){b&&t(d,
function(b,d){m(function(){d(a)})},void 0)};return f}function n(a,b,d,c){void 0===b&&(b=function(a){return p(Error("Promise does not support operation: "+a))});var f=z(n.prototype);f.promiseDispatch=function(d,c,e){var g;try{g=a[c]?a[c].apply(f,e):b.call(f,c,e)}catch(j){g=p(j)}d&&d(g)};d&&(f.valueOf=d);c&&(f.exception=c);return f}function r(a){return x(a)?a.valueOf():a}function x(a){return a&&"function"===typeof a.promiseDispatch}function B(a){return a&&"function"===typeof a.then}function C(a){return!B(r(a))}
function N(a){a=r(a);return x(a)&&"exception"in a}function p(a){var b=n({when:function(b){if(b){var c=Z(D,this);-1!==c&&(u.splice(c,1),D.splice(c,1))}return b?b(a):this}},function(){return p(a)},function(){return this},a);!O&&("undefined"!==typeof window&&!window.Touch&&window.console)&&console.log("Should be empty:",u);O=!0;D.push(b);u.push(a);return b}function A(a){return n({when:function(){return a},get:function(b){return a[b]},set:function(b,d){a[b]=d},"delete":function(b){delete a[b]},post:function(b,
d){return null==b?a.apply(void 0,d):a[b].apply(a,d)},apply:function(b){return a.apply(void 0,b)},keys:function(){return $(a)}},void 0,function(){return a})}function q(a){if(x(a))return a;a=r(a);if(B(a)){var b=j();a.then(b.resolve,b.reject,b.notify);return b.promise}return A(a)}function g(a,b,d,e){function f(a){try{return"function"===typeof b?b(a):a}catch(d){return p(d)}}function k(a){if("function"===typeof d){I(a,l);try{return d(a)}catch(b){return p(b)}}return p(a)}var g=j(),h=!1,l=q(a);m(function(){l.promiseDispatch(function(a){h||
(h=!0,g.resolve(f(a)))},"when",[function(a){h||(h=!0,g.resolve(k(a)))}])});l.promiseDispatch(void 0,"when",[void 0,function(a){var b,d=!1;try{b="function"===typeof e?e(a):a}catch(f){if(d=!0,c.onerror)c.onerror(f);else throw f;}d||g.notify(b)}]);return g.promise}function P(a,b,d){return g(a,function(a){return y(a).then(function(a){return b.apply(void 0,a)},d)},d)}function E(a,b,d){var c=j();m(function(){q(a).promiseDispatch(c.resolve,b,d)});return c.promise}function s(a){return function(b){var d=h(arguments,
1);return E(b,a,d)}}function R(a,b){var d=h(arguments,2);return F(a,b,d)}function G(a){var b=h(arguments,1);return v(a,b)}function y(a){return g(a,function(a){var d=a.length;if(0===d)return q(a);var c=j();t(a,function(f,k,h){C(k)?(a[h]=r(k),0===--d&&c.resolve(a)):g(k,function(f){a[h]=f;0===--d&&c.resolve(a)}).fail(c.reject)},void 0);return c.promise})}function S(a,b){return g(a,void 0,b)}var X=M(),L,T=function(){},m;if("undefined"!==typeof process)m=process.nextTick;else if("function"===typeof setImmediate)m=
"undefined"!==typeof window?setImmediate.bind(window):setImmediate;else if("undefined"!==typeof MessageChannel){var U=new MessageChannel,w={},V=w;U.port1.onmessage=function(){w=w.next;var a=w.task;delete w.task;a()};m=function(a){V=V.next={task:a};U.port2.postMessage(0)}}else m=function(a){setTimeout(a,0)};var h=l(Array.prototype.slice),t=l(Array.prototype.reduce||function(a,b){var d=0,c=this.length;if(1===arguments.length){do{if(d in this){b=this[d++];break}if(++d>=c)throw new TypeError;}while(1)
}for(;d<c;d++)d in this&&(b=a(b,this[d],d));return b}),Z=l(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),W=l(Array.prototype.map||function(a,b){var d=this,c=[];t(d,function(f,k,g){c.push(a.call(b,k,g,d))},void 0);return c}),z=Object.create||function(a){function b(){}b.prototype=a;return new b},$=Object.keys||function(a){var b=[],d;for(d in a)b.push(d);return b},aa=l(Object.prototype.toString),H;H="undefined"!==typeof ReturnValue?ReturnValue:
function(a){this.value=a};c.longStackJumpLimit=1;var J="From previous event:";c.nextTick=m;c.defer=j;j.prototype.makeNodeResolver=function(){var a=this;return function(b,d){b?a.reject(b):2<arguments.length?a.resolve(h(arguments,1)):a.resolve(d)}};c.promise=function(a){var b=j();G(a,b.resolve,b.reject,b.notify).fail(b.reject);return b.promise};c.makePromise=n;n.prototype.then=function(a,b,d){return g(this,a,b,d)};n.prototype.thenResolve=function(a){return g(this,function(){return a})};t("isFulfilled isRejected isPending dispatch when spread get put set del delete post send invoke keys fapply fcall fbind all allResolved timeout delay catch finally fail fin progress done nfcall nfapply nfbind ncall napply nbind npost nsend ninvoke nodeify".split(" "),
function(a,b){n.prototype[b]=function(){return c[b].apply(c,[this].concat(h(arguments)))}},void 0);n.prototype.toSource=function(){return this.toString()};n.prototype.toString=function(){return"[object Promise]"};c.nearer=r;c.isPromise=x;c.isPromiseAlike=B;c.isPending=function(a){return!C(a)&&!N(a)};c.isFulfilled=C;c.isRejected=N;var D=[],u=[],O;if("undefined"!==typeof process&&process.on)process.on("exit",function(){for(var a=0;a<u.length;a++){var b=u[a];b&&"undefined"!==typeof b.stack?console.warn("Unhandled rejected promise:",
b.stack):console.warn("Unhandled rejected promise (no stack):",b)}});c.reject=p;c.fulfill=A;c.resolve=q;c.master=function(a){return n({isDef:function(){}},function(b,d){return E(a,b,d)},function(){return r(a)})};c.when=g;c.spread=P;c.async=function(a){return function(){function b(a,b){var h;try{h=d[a](b)}catch(j){return"[object StopIteration]"===aa(j)||j instanceof H?j.value:p(j)}return g(h,c,f)}var d=a.apply(this,arguments),c=b.bind(b,"send"),f=b.bind(b,"throw");return c()}};c["return"]=function(a){throw new H(a);
};c.promised=function(a){return function(){return P([this,y(arguments)],function(b,d){return a.apply(b,d)})}};c.dispatch=E;c.dispatcher=s;c.get=s("get");c.set=s("set");c["delete"]=c.del=s("delete");var F=c.post=s("post");c.send=R;c.invoke=R;var v=c.fapply=s("apply");c["try"]=G;c.fcall=G;c.fbind=function(a){var b=h(arguments,1);return function(){var d=b.concat(h(arguments));return v(a,d)}};c.keys=s("keys");c.all=y;c.allResolved=function(a){return g(a,function(a){a=W(a,q);return g(y(W(a,function(a){return g(a,
T,T)})),function(){return a})})};c["catch"]=c.fail=S;c.progress=function(a,b){return g(a,void 0,void 0,b)};c["finally"]=c.fin=function(a,b){return g(a,function(a){return g(b(),function(){return a})},function(a){return g(b(),function(){return p(a)})})};c.done=function(a,b,d,e){var f=function(b){m(function(){I(b,a);if(c.onerror)c.onerror(b);else throw b;})};b=b||d||e?g(a,b,d,e):a;"object"===typeof process&&(process&&process.domain)&&(f=process.domain.bind(f));S(b,f)};c.timeout=function(a,b){var d=j(),
c=setTimeout(function(){d.reject(Error("Timed out after "+b+" ms"))},b);g(a,function(a){clearTimeout(c);d.resolve(a)},function(a){clearTimeout(c);d.reject(a)});return d.promise};c.delay=function(a,b){void 0===b&&(b=a,a=void 0);var d=j();setTimeout(function(){d.resolve(a)},b);return d.promise};c.nfapply=function(a,b){var d=h(b),c=j();d.push(c.makeNodeResolver());v(a,d).fail(c.reject);return c.promise};c.nfcall=function(a){var b=h(arguments,1),c=j();b.push(c.makeNodeResolver());v(a,b).fail(c.reject);
return c.promise};c.nfbind=function(a){var b=h(arguments,1);return function(){var c=b.concat(h(arguments)),e=j();c.push(e.makeNodeResolver());v(a,c).fail(e.reject);return e.promise}};c.npost=function(a,b,c){c=h(c);var e=j();c.push(e.makeNodeResolver());F(a,b,c).fail(e.reject);return e.promise};c.nsend=function(a,b){var c=h(arguments,2),e=j();c.push(e.makeNodeResolver());F(a,b,c).fail(e.reject);return e.promise};c.ninvoke=c.nsend;c.nodeify=function(a,b){if(b)a.then(function(a){m(function(){b(null,
a)})},function(a){m(function(){b(a)})});else return a};var Y=M();return c});
